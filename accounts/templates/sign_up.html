{% extends "base.html" %}

{% load staticfiles %}

{% block content %}

<div class="row wall" ng-controller="signUpMainCtrl">

    <div class="col-md-12" style="padding-top: 50px;">
        <div class="row" style="margin-right: 2%;">
            <div class="col-md-8">
            </div>

            <div class="col-md-4 well">
                {% verbatim %}
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-12" align="center">
                            <h3 class="h3_class">Create an account </h3>
                        </div><br><br><br>
                    </div>
                    <div class="row">
                        <div ng-view></div>
                    </div>
                </div>

            <script type="text/ng-template" id="signUp.html">
                    <div class="row">
                        <div class="col-md-12" align="center">
                            <a href="#login1" class="btn btn-xs" ng-class="getClass(source, 1)">Signup1
                            </a>
                            <a href="#login2" class="btn btn-xs" ng-class="getClass(source, 2)">Signup2
                            </a>
                            <a href="#login3" class="btn btn-xs" ng-class="getClass(source, 3)"> Signup3
                            </a>
                        </div>
                    </div>

                <div class="container-fluid">
                    <div class="row" ng-if="responseData.msg.cls == 'success'">
                        <div class="col-md-7 custom-padding-5" ng-show="alerts">
                            <div class="alert alert-{{ responseData.msg.cls }}" uib-alert>{{  responseData.msg.type }}</div>
                        </div>
                    </div>
                    <div class="row" ng-repeat="(f, v) in form_field">
                        <div class="col-md-12 custom-padding-5" style="padding-left: 11%">
                            <input ng-if="hasMeter && f=='password'" type="{{ v.type }}" ng-model="data[f]"
                                class="custom-input" placeholder="{{ f }}"
                                uib-popover-html="htmlPopover"
                                popover-trigger="'none'"
                                popover-is-open='{{ isOpen }}'
                                popover-placement="left"
                                ng-change="validate()">

                            <input ng-hide="hasMeter && f=='password'" type="{{ v.type }}" ng-model="data[f]"
                                   class="custom-input" placeholder="{{ f }}" ><br/><br/>
                            <span class="text-danger">{{ responseData[f].msg }}</span>
                        </div>
                    </div>
                    <div class="row" style="padding-left: 25px;">
                        <div class="col-md-12">
                            <input ng-click="authenticate()" type="submit" class="btn btn-sm btn-info"
                                   style="font-size:15px;width: 90%" value="Create an account" />
                        </div>
                    </div>
                </div>
            </script>

            {% endverbatim %}
        </div>
    </div>

</div>
{% endblock %}


{% block extrascript %}

{{ ngapp }}.config(['$routeProvider', function($routeProvider){
    $routeProvider
        .when('/',{
            templateUrl: 'signUp.html',
            controller: 'signUpMainCtrl'
        })
        .when('/login2', {
            templateUrl: 'signUp.html',
            controller: 'signUpCtrl'
        })
        .when('/login3', {
            templateUrl: 'signUp.html',
            controller: 'signUpCtrl2'
        })
        .otherwise({redirectTo:'/'});
}]);


{{ ngapp }}.factory('signUpFactory', function($http, $q, $sce){
    var data = {};
    data.post = function(url, data){
        var deferred = $q.defer();
        $http.post(url, data).then(function(data){
            return deferred.resolve(data);
        });
        return deferred.promise;
    };

    data.form_field = {
        first_name: { type: 'text', value: ''},
        last_name: { type: 'text', value: ''},
        username: { type: 'text', value: ''},
        email: { type: 'text', value: ''},
        password: { type: 'password', value: ''},
        confirm_password: { type: 'password', value: ''},
    };

    data.getClass = function(val1, val2){
        if(val1 == val2){
            return "btn-danger";
        }else{
            return "btn-info";
        }
    };

    data.htmlPopover3 = $sce.trustAsHtml("Use at least 8 characters long or more<br/> a lowercase character<br/> Add an uppercase character<br/> Add a number<br/> Add a special character (e.g., ?, %, &)<br/> ");
    return data;

});


{{ ngapp }}.controller('signUpMainCtrl', function($scope, signUpFactory){

    $scope.login_url = "{%  url 'login' %}";
    $scope.signup_authenticate = "{%  url 'signup_authenticate' %}";
    $scope.alerts = [];
    $scope.warning = {};
    $scope.hasMeter = false;
    $scope.source = 1;



    $scope.data = {
        first_name: '',
        last_name: '',
        username: '',
        email: '',
        password: '',
        confirm_password: '',
    };
    $scope.form_field = signUpFactory.form_field;
    $scope.getClass = function(v1, v2){
        return signUpFactory.getClass(v1, v2);
    };

    $scope.authenticate = function(){
        $scope.warning = {};
        console.log($scope.data);
        signUpFactory.post($scope.signup_authenticate , $scope.data).then(function(response){
            $scope.responseData = response.data;
        });
    };

    $scope.closeAlert = function(index) {
        $scope.alerts.splice(index, 1);
    };

    $scope.validate = function(){
        console.log('nothign to do');
    };


});


{{ ngapp }}.controller('signUpCtrl', function($scope, signUpFactory, $sce){
    $scope.signup_authenticate = "{%  url 'signup_authenticate2' %}";
    $scope.validation_url = "{%  url 'password_validate' %}";
    $scope.hasMeter = true;
    $scope.validationResponse  = {};
    $scope.source = 2;
    $scope.isOpen = true;

    $scope.data = {
        first_name: '',
        last_name: '',
        username: '',
        email: '',
        password: '',
        confirm_password: '',
    };

    $scope.form_field = signUpFactory.form_field;


    $scope.getValidationResponseCls =function(criteria){
        if($scope.validationResponse.hasOwnProperty(criteria)){
            return "text-success glyphicon-ok";
        }else{
            return "text-danger glyphicon-remove";
        }
    };

    $scope.htmlPopover = $sce.trustAsHtml("<i class='glyphicon "+$scope.getValidationResponseCls('length')+ "'></i>: Use at least 8 characters long or more<br/> <i class='glyphicon "+$scope.getValidationResponseCls('lower')+ "'></i> : a lowercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('upper')+ "'></i> : Add an uppercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('number')+ "'></i> : Add a number<br/> <i class='glyphicon "+$scope.getValidationResponseCls('special')+ "'></i> : Add a special character (e.g., ?, %, &)<br/>");



    $scope.meterMessage = function(){
        $scope.validationResponse  = {};
        signUpFactory.post($scope.validation_url, $scope.data).then(function(response){
            $scope.validationResponse = response.data;
            $scope.htmlPopover = $sce.trustAsHtml("<i class='glyphicon "+$scope.getValidationResponseCls('length')+ "'></i>: Use at least 8 characters long or more<br/> <i class='glyphicon "+$scope.getValidationResponseCls('lower')+ "'></i> : a lowercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('upper')+ "'></i> : Add an uppercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('number')+ "'></i> : Add a number<br/> <i class='glyphicon "+$scope.getValidationResponseCls('special')+ "'></i> : Add a special character (e.g., ?, %, &)<br/>");
            console.log(response.data);
        });
    };

    $scope.authenticate = function(){
        $scope.openMeter = false;
        signUpFactory.post($scope.signup_authenticate , $scope.data).then(function(response){
            $scope.responseData = response.data;
            $scope.meterMessage();
            $scope.isOpen = true;
            console.log(response.data);
        });
    };


    $scope.closeAlert = function(index) {
        $scope.alerts.splice(index, 1);
    };


});


{{ ngapp }}.controller('signUpCtrl2', function($scope, $sce, $timeout, signUpFactory){
    $scope.hasMeter = true;
    $scope.validationResponse  = {};
    $scope.requesting = false;
    $scope.source = 3;
    $scope.isOpen = true;

    $scope.data = {
        first_name: '',
        last_name: '',
        username: '',
        email: '',
        password: '',
        confirm_password: '',
    };
    $scope.getValidationResponseCls =function(criteria){
        if($scope.validationResponse.hasOwnProperty(criteria)){
            return "text-success glyphicon-ok";
        }else{
            return "text-danger glyphicon-remove";
        }
    };

    $scope.form_field = signUpFactory.form_field;
    var contents = $sce.trustAsHtml("<i class='glyphicon "+$scope.getValidationResponseCls('hacker_list')+ "'></i> : Not in a hackers list<br/><i class='glyphicon "+$scope.getValidationResponseCls('dictionary_word')+ "'></i> : Not a dictionary word<br/> <i class='glyphicon "+$scope.getValidationResponseCls('length')+ "'></i>: Use at least 8 characters long or more<br/> <i class='glyphicon "+$scope.getValidationResponseCls('lower')+ "'></i> : a lowercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('upper')+ "'></i> : Add an uppercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('number')+ "'></i> : Add a number<br/> <i class='glyphicon "+$scope.getValidationResponseCls('special')+ "'></i> : Add a special character (e.g., ?, %, &)<br/>");
    $scope.htmlPopover = contents;
    $scope.strength = "Too short";

    $scope.signup_authenticate = "{%  url 'signup_authenticate2' %}";
    $scope.validation_url = "{%  url 'password_validate' %}";

    $scope.authenticate = function(){
        $scope.openMeter = false;
        signUpFactory.post($scope.signup_authenticate , $scope.data).then(function(response){
            $scope.responseData = response.data;
            $scope.validationResponse  = {
                lower: {cls : 'well' }
            };
            console.log(response.data);

        });
    };

    $scope.validate = function(){
       if(!$scope.requesting){

            $scope.requesting = true;
            $timeout(
                function(){
                    $scope.validationResponse  = {};
                    signUpFactory.post($scope.validation_url, $scope.data).then(function(response){
                        $scope.validationResponse = response.data;
                        $scope.htmlPopover = $sce.trustAsHtml("<div class='progress'> <div class='progress-bar progress-bar-"+$scope.validationResponse.msg.cls+"' role='progressbar' aria-valuenow='40' aria-valuemin='0' aria-valuemax='100' style='width:"+ $scope.validationResponse.msg.percent +"'>"+ $scope.validationResponse.msg.msg +"</div> </div><i class='glyphicon "+$scope.getValidationResponseCls('hacker_list')+ "'></i> : Not in a hackers list<br/><i class='glyphicon "+$scope.getValidationResponseCls('dictionary_word')+ "'></i> : Not a dictionary word<br/> <i class='glyphicon "+$scope.getValidationResponseCls('length')+ "'></i>: Use at least 8 characters long or more<br/> <i class='glyphicon "+$scope.getValidationResponseCls('lower')+ "'></i> : a lowercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('upper')+ "'></i> : Add an uppercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('number')+ "'></i> : Add a number<br/> <i class='glyphicon "+$scope.getValidationResponseCls('special')+ "'></i> : Add a special character (e.g., ?, %, &)<br/>");
                        $scope.requesting = false;
                        console.log(response.data);
                    });
                }, 10
            );
        }else{
            if($scope.data.password == '' || $scope.data.password == null){
                $scope.validationResponse  = {msg : ''};
                $scope.htmlPopover = $sce.trustAsHtml("<div class='progress'> <div class='progress-bar progress-bar-"+$scope.validationResponse.msg.cls+"' role='progressbar' aria-valuenow='40' aria-valuemin='0' aria-valuemax='100' style='width:"+ $scope.validationResponse.msg.percent +"'>"+ $scope.validationResponse.msg.msg +"</div> </div><i class='glyphicon "+$scope.getValidationResponseCls('hacker_list')+ "'></i> : Not in a hackers list<br/><i class='glyphicon "+$scope.getValidationResponseCls('dictionary_word')+ "'></i> : Not a dictionary word<br/> <i class='glyphicon "+$scope.getValidationResponseCls('length')+ "'></i>: Use at least 8 characters long or more<br/> <i class='glyphicon "+$scope.getValidationResponseCls('lower')+ "'></i> : a lowercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('upper')+ "'></i> : Add an uppercase character<br/> <i class='glyphicon "+$scope.getValidationResponseCls('number')+ "'></i> : Add a number<br/> <i class='glyphicon "+$scope.getValidationResponseCls('special')+ "'></i> : Add a special character (e.g., ?, %, &)<br/>");
            }
        }
    };

});


{% endblock %}
