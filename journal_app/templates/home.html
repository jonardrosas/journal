{% extends "base.html" %}

{% load staticfiles %}
{% block content %}
{%  verbatim  %}
<div class="row" ng-controller="myCtrl">
    <div class="col-md-12" align="right">
        <a href="#" ng-click="createJournal()"><img src="{{ plusImg }}" width="50" height="50" alt=""></a>
    </div>
    <div class="col-md-12">
        <script type="text/ng-template" id="createJournal.html">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Please Login!</h3>
            </div>
            <div class="modal-body" id="modal-body">
                <div class="row" ng-repeat="(f, v) in form_fields">
                    <div class="col-md-12 custom-padding-5">
                        <label>{{ f }}</label><br/>
                        <input class="form-control" ng-if="v.type!='select'" type="{{ v.type }}" ng-model="data[f]" class="form-control" placeholder="{{ f }}" >
                        <select ng-if="v.type=='select'" ng-model="data[f]" class="form-control" ><option ng-repeat="x in v.val">{{ x.name }}</option></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" ng-click="saveJournal()" type="button">Save</button>
                <button class="btn btn-primary" ng-click="cancel()" type="button">Cancel</button>
            </div>
        </script>
        <div class="row" >
            <div class="col-md-12">
                <div ng-repeat="o in journals track by $index" class="col-md-4">
                    <div class="col-md-12" align="center" style="font-family: Courier New, Courier, monospace;">
                        <div class="col-md-12" style="background-color: #c1c1c1">
                            <h3><b>{{ o.name }}</b></h3>
                        </div>
                        <div class="col-md-12" style="border: solid 1px">{{ o.type }}</div>
                        <div class="col-md-12" align="right"><a href="/journal_entries/get/{{ o.id }}/">View</a></div>
                    </div>
                    <div class="col-md-12" style="height: 25px;"></div>

                </div>
            </div>
        </div>
        <div class="row" ng-if="journals.length < 1">
            <div class="col-md-7 custom-padding-5">
                <div class="alert alert-warning" uib-alert close="closeAlert($index)">No Journals Available!</div>
            </div>
        </div>
    </div>
    {%  endverbatim  %}

</div>
{% endblock %}

    {% block extrascript %}
    {{ ngapp }}.controller("myCtrl", function($scope, $http, $uibModal) {

         var url = "{% url 'journal_vew' %}";
         $scope.plusImg = "{% static 'img/add.png' %}"
         $scope.journals = [];

         $scope.initData = function(){
             $http.get(url).then(function(response){
                 $scope.journals = response.data.data;
                 console.log($scope.journals);
             });
         };

        $scope.createJournal = function (size) {
            var modalInstance = $uibModal.open({
                templateUrl: 'createJournal.html',
                controller: 'createJournalCtrl',
                size: "lg",
                backdrop: 'static',
            });

            modalInstance.result.then(function (result) {
                if(result == 'success'){
                    $scope.initData();
                }
            }, function () {
                $scope.hovering = false;
            });

        };
         $scope.initData();
    });


    {{ ngapp }}.controller('createJournalCtrl', function ($scope, $uibModalInstance, $http) {

        $scope.data = {};
        var url = "{% url 'create_journal' %}";

        $scope.form_fields = {
            'name': {val: '', type: 'text'},
            'type': {val: [
                            {name: 'Personal'},
                            {name: 'Academic'}
                          ],
                        type: 'select'
                    },
        }

        $scope.closeAlert = function(index) {
        };

        $scope.saveJournal = function(){
             $http.post(url, $scope.data).then(function(response){
                if (response.data.status == 'success'){
                    $uibModalInstance.close('success');
                }else{
                    alert('Internal Error');
                }
             });
        };

        $scope.cancel = function () {
          $uibModalInstance.dismiss('cancel');
        };
    });



    {% endblock %}
